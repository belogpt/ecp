
ИНСТРУКЦИЯ ПО ПРОГРАММЕ «Визуализация ЭЦП в PDF»
------------------------------------------------

1. Назначение программы
------------------------
Программа предназначена для наглядного отображения сведений об электронной подписи (ЭЦП)
к PDF‑документам и добавления штампа с этой информацией прямо на страницу PDF.

Основные возможности:
- загрузка одного или нескольких PDF‑файлов и соответствующих файлов подписи (*.p7s);
- автоматический поиск подходящей подписи к каждому PDF;
- проверка соответствия подписи документу и срока действия сертификата;
- отображение сведений о сертификате;
- визуальное размещение штампа на выбранной странице;
- сохранение нового PDF с нанесённым штампом.

Программа НЕ изменяет исходные PDF‑файлы. Для каждого документа создаётся новый файл
с суффиксом «_ЭЦП_ДД.ММ.ГГГГ_ЧЧ.ММ.СС».


2. Запуск программы
-------------------
Программа запускается обычным двойным щелчком по исполняемому файлу (или из среды разработки,
если вы используете исходники). После запуска открывается главное окно с четырьмя областями:

- слева: список загруженных PDF‑файлов;
- слева по центру: миниатюры страниц выбранного документа;
- по центру: просмотр страницы и штампа;
- справа: сведения о сертификате и параметры сохранения.


3. Загрузка файлов
------------------

3.1. Перетаскивание мышью
--------------------------
Вы можете просто перетащить один или несколько файлов мышью в окно программы.
Поддерживаются файлы:
- PDF‑документы (*.pdf);
- файлы подписи (*.p7s).

Порядок не важен: можно сначала добавить PDF, потом подписи, или наоборот,
а также смешанные наборы файлов.

3.2. Кнопка «Добавить файлы…»
------------------------------
Нажмите «Добавить файлы…» и выберите один или несколько файлов PDF и/или P7S.
Программа обработает выбранные файлы и попытается сопоставить подписи с документами.

3.3. Кнопка «Добавить папку…»
------------------------------
Нажмите «Добавить папку…» и выберите каталог. Программа рекурсивно обойдёт все вложенные папки
и добавит все найденные файлы с расширениями .pdf и .p7s.

Во время загрузки внизу окна отображается прогресс:
«Обработка файла X из Y: имя_файла».


4. Сопоставление PDF и подписи
-------------------------------
После загрузки программа автоматически пытается найти для каждого PDF подходящий файл подписи:

- сначала проверяются подписи, находящиеся в той же папке, что и PDF;
- затем — подписи из других папок;
- для каждой пары «PDF + P7S» выполняется проверка соответствия (хэш документа, срок действия и т.п.).

Если подпись подходит:
- в левом списке файлов напротив документа появляется пометка «(подпись найдена)»;
- справа заполняются поля «Сертификат», «Владелец», «Время подписи», «Действителен», «Статус подписи».

Если подпись НЕ найдена или не подходит (документ не совпадает, подпись не подтверждена и т.п.):
- статус будет «нет файла подписи» или иная «ошибочная» формулировка;
- штамп не будет доступен для этого файла;
- кнопка «Сохранить файл с ЭЦП» будет неактивна.


5. Список документов (левая колонка)
------------------------------------
В левой части окна отображается список всех загруженных PDF‑файлов.

Каждый элемент списка содержит:
- имя файла;
- пометку «(подпись найдена)» или «(нет файла подписи)»;
- зелёную галочку «✔» в начале, если для этого файла уже был сохранён PDF с ЭЦП.

При выборе документа в центральной части отображается первая страница этого PDF,
а справа — сведения о сертификате (если подпись найдена и корректна).


6. Выбор страницы
-----------------
Под списком файлов (во второй колонке) всегда отображаются миниатюры страниц
текущего документа, даже если страница всего одна.

- щёлкните по миниатюре, чтобы перейти на соответствующую страницу;
- текущая страница подсвечивается.


7. Просмотр страницы и управление штампом
-----------------------------------------

7.1. Просмотр страницы
----------------------
В центральной области отображается выбранная страница PDF.

Управление:
- увеличение/уменьшение: удерживайте Ctrl и прокручивайте колесо мыши;
- перемещение (панорамирование): удерживайте клавишу Пробел и левую кнопку мыши,
  затем двигайте мышью.

При переключении на другой файл программа всегда показывает первую страницу этого документа.


7.2. Штамп
----------
Если для документа найдена корректная подпись, на странице отображается прямоугольник штампа.

Особенности:
- штамп всегда имеет фиксированное соотношение сторон — при изменении размера пропорции сохраняются;
- при первом показе штамп появляется внизу страницы, по центру;
- штамп содержит:
  - верхнюю чёрную «шапку» с текстом «Документ подписан электронной подписью»;
  - при наличии логотипа — картинку и до трёх строк текста шапки (настраивается в меню «Настройки»);
  - блок сведений: Сертификат, Владелец, Действителен, (опционально) Время подписи.

Перемещение штампа:
- просто перетаскивайте прямоугольник штампа мышью (ЛКМ за любую область штампа).

Изменение размера:
- потяните за синюю ручку в правом нижнем углу;
- штамп увеличивается или уменьшается пропорционально, текст масштабируется вместе с ним.


8. Сведения о сертификате (правая панель)
-----------------------------------------
В правой части окна отображаются поля:

- Сертификат — серийный номер сертификата;
- Владелец — ФИО или название организации;
- Время подписи — дата и время подписи (если удалось определить);
- Действителен — срок действия сертификата (с / по);
- Статус подписи — результат проверки подписи.

Цвет статуса:
- зелёный — подпись действительна и соответствует документу;
- оранжевый — нет подходящей подписи;
- красный — ошибка проверки, подпись не подтверждена, сертификат просрочен и т.п.

Если статус «плохой», штамп для такого файла не отображается, а сохранить файл с ЭЦП нельзя.


9. Настройки сохранения
-----------------------

9.1. Папка сохранения
----------------------
В блоке «Сохранение» доступны настройки:

- поле «Папка сохранения» и кнопка «…» — используется, если выключен режим
  «Сохранять файл в исходное месторасположение»;
- флажок «Сохранять файл в исходное месторасположение»:
  - если флажок включён — новый PDF будет сохраняться рядом с исходным документом;
  - если флажок выключен — нужно выбрать общую папку для сохранения всех документов.

Имя создаваемого файла:
«ИсходноеИмяФайла_ЭЦП_ДД.ММ.ГГГГ_ЧЧ.ММ.СС.pdf».


9.2. Отображение времени подписи на штампе
------------------------------------------
Флажок «Показывать время подписи на штампе» управляет тем, будет ли строка «Время подписи»
выводиться в самом штампе. Настройка запоминается и восстанавливается при следующем запуске программы.

Если флажок снят, время подписи не добавляется в штамп, но может отображаться справа в сведениях.


10. Сохранение файла с ЭЦП
---------------------------
Чтобы сохранить документ со штампом:

1. Выберите документ в левом списке.
2. Убедитесь, что статус подписи зелёный или корректный.
3. Выберите нужную страницу по миниатюре (если страниц несколько).
4. Расположите штамп в нужном месте и при необходимости измените его размер.
5. Настройте папку сохранения:
   - либо включите «Сохранять файл в исходное месторасположение»;
   - либо выберите общую папку для сохранения.
6. Нажмите кнопку «Сохранить файл с ЭЦП».

После успешного сохранения:
- справа внизу появится сообщение «Сохранён файл: …»;
- в левом списке перед именем файла появится галочка «✔»;
- автоматически будет выбран следующий документ (если он есть).


11. Настройки шапки штампа
--------------------------
В меню «Настройки» доступен пункт «Шапка штампа…».

В окне настроек можно:
- выбрать картинку (PNG, квадратная) для логотипа;
- задать многострочный текст шапки (он автоматически разбивается максимум на 3 строки);
- удалить изображение и текст кнопкой «Удалить изображение и текст».

Особенности:
- если не выбрана картинка, то место под логотип и три строки шапки не отображается;
- если текст слишком длинный, он может обрезаться по ширине — за пределы штампа не выводится;
- логотип по высоте подгоняется под три строки текста шапки, чтобы всё выглядело аккуратно.


12. Меню «Помощь»
------------------
В меню «Помощь» доступны пункты:
- «Инструкция» — открывает это окно с текстовой справкой;
- «О программе» — краткая информация об авторе, версии и дате создания программы.


13. Файлы без подписи
----------------------
Если для PDF не найден подходящий файл подписи или подпись не проходит проверку, то:

- в статусе будет указано, что подпись отсутствует или не подтверждена;
- штамп в области просмотра не отображается;
- кнопка «Сохранить файл с ЭЦП» недоступна.

Таким образом, программа не позволяет случайно поставить штамп на документ,
для которого нет корректной ЭЦП.


14. Завершение работы
---------------------
Для выхода из программы используйте:
- пункт меню «Файл → Выйти»
или
- стандартную кнопку закрытия окна.

Настройки шапки и флажка «Показывать время подписи на штампе» сохраняются между запусками.
